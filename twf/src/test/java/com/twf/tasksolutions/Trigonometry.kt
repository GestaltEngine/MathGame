package com.twf.tasksolutions

import com.twf.config.CompiledConfiguration
import com.twf.config.FactTransformationRule
import com.twf.factstransformations.FactConstructorViewer
import com.twf.factstransformations.FactSubstitution
import com.twf.factstransformations.MainLineAndNode
import com.twf.factstransformations.parseFromFactIdentifier
import com.twf.logs.log
import com.twf.mainpoints.checkFactsInMathML
import com.twf.mainpoints.compiledConfigurationBySettings
import com.twf.mainpoints.configSeparator
import com.twf.org.junit.Assert
import com.twf.org.junit.Ignore
import com.twf.org.junit.Test

class Trigonometry {
    val wellKnownFunctions = "" +
            "${configSeparator}0$configSeparator" +
            "${configSeparator}1$configSeparator" +
            "+$configSeparator-1$configSeparator" +
            "-$configSeparator-1$configSeparator" +
            "*$configSeparator-1$configSeparator" +
            "/$configSeparator-1$configSeparator" +
            "^$configSeparator-1"

    val wellKnownFunctionsWithoutDegree = "" +
            "${configSeparator}0$configSeparator" +
            "${configSeparator}1$configSeparator" +
            "+$configSeparator-1$configSeparator" +
            "-$configSeparator-1$configSeparator" +
            "*$configSeparator-1$configSeparator" +
            "/$configSeparator-1"

    val expressionTransformationRules = "" +
            "sin(x)^2${configSeparator}1 - cos(x)^2${configSeparator}" +
            "cos(x)^2${configSeparator}1 - sin(x)^2${configSeparator}" +
            "cos(x)^2+sin(x)^2${configSeparator}1${configSeparator}" +
            "tg(x)${configSeparator}sin(x)/cos(x)${configSeparator}" +
            "ctg(x)${configSeparator}cos(x)/sin(x)${configSeparator}" +
            "ctg(x)tg(x)${configSeparator}1${configSeparator}" +
            "tg(x)^2+1${configSeparator}1/cos(x)^2${configSeparator}" +
            "ctg(x)^2+1${configSeparator}1/sin(x)^2${configSeparator}" +
            "sin(x+y)${configSeparator}sin(x)cos(y)+sin(y)cos(x)${configSeparator}" +
            "sin(x-y)${configSeparator}sin(x)cos(y)-sin(y)cos(x)${configSeparator}" +
            "cos(x+y)${configSeparator}cos(x)cos(y)-sin(x)sin(y)${configSeparator}" +
            "cos(x-y)${configSeparator}cos(x)cos(y)+sin(x)sin(y)${configSeparator}" +
            "tg(x+y)${configSeparator}(tg(x)+tg(y))/(1-tg(x)tg(y))${configSeparator}" +
            "tg(x-y)${configSeparator}(tg(x)-tg(y))/(1+tg(x)tg(y))${configSeparator}" +
            "ctg(x+y)${configSeparator}(ctg(x)ctg(y)-1)/(ctg(x)+ctg(y))${configSeparator}" +
            "ctg(x-y)${configSeparator}(ctg(x)ctg(y)+1)/(ctg(x)-ctg(y))${configSeparator}" +
            "sin(2*x)${configSeparator}2*sin(x)cos(x)${configSeparator}" +
            "sin(2*x)${configSeparator}2*tg(x)/(1+(tg(x))^2)${configSeparator}" +
            "cos(2*x)${configSeparator}cos(x)^2 - sin(x)^2${configSeparator}" +
            "cos(2*x)${configSeparator}2*cos(x)^2 - 1${configSeparator}" +
            "cos(2*x)${configSeparator}1 - 2*sin(x)^2${configSeparator}" +
            "cos(2*x)${configSeparator}(1-(tg(x))^2)/(1+(tg(x))^2)${configSeparator}" +
            "sin(x)^2${configSeparator}(1 - cos(2*x))/2${configSeparator}" +
            "cos(x)^2${configSeparator}(1 + cos(2*x))/2${configSeparator}" +
            "sin(x)+sin(y)${configSeparator}2*sin((x+y)/2)*cos((x-y)/2)${configSeparator}" +
            "sin(x)-sin(y)${configSeparator}2*sin((x-y)/2)*cos((x+y)/2)${configSeparator}" +
            "cos(x)+cos(y)${configSeparator}2*cos((x+y)/2)*cos((x-y)/2)${configSeparator}" +
            "cos(x)-cos(y)${configSeparator}2*sin((x+y)/2)*sin((x-y)/2)${configSeparator}" +
            "sin(x)sin(y)${configSeparator}(cos(x-y)-cos(x+y))/2${configSeparator}" +
            "sin(x)cos(y)${configSeparator}(sin(x-y)+sin(x+y))/2${configSeparator}" +
            "cos(x)cos(y)${configSeparator}(cos(x-y)+cos(x+y))/2${configSeparator}" +
            "sin(0)${configSeparator}0${configSeparator}" +
            "sin(pi/2)${configSeparator}1${configSeparator}" +
            "cos(0)${configSeparator}1${configSeparator}" +
            "cos(pi/2)${configSeparator}0${configSeparator}" +
            "sin(pi/6)${configSeparator}1/2${configSeparator}" +
            "sin(pi/4)${configSeparator}2^0.5/2${configSeparator}" +
            "sin(pi/3)${configSeparator}3^0.5/2${configSeparator}" +
            "cos(pi/3)${configSeparator}1/2${configSeparator}" +
            "cos(pi/4)${configSeparator}2^0.5/2${configSeparator}" +
            "cos(pi/6)${configSeparator}3^0.5/2${configSeparator}" +
            "cos(pi/6)${configSeparator}3^0.5/2${configSeparator}" +
            "cos(-x)${configSeparator}cos(x)${configSeparator}" +
            "sin(-x)${configSeparator}-sin(x)${configSeparator}" +
            "sin(pi-x)${configSeparator}sin(x)${configSeparator}" +
            "cos(pi-x)${configSeparator}-cos(x)${configSeparator}" +
            "sin(x+2*pi)${configSeparator}sin(x)${configSeparator}" +
            "cos(x+2*pi)${configSeparator}cos(x)${configSeparator}" +
            "cos(pi/2-x)${configSeparator}sin(x)${configSeparator}" +
            "sin(pi/2-x)${configSeparator}cos(x)"

    @Test
    fun proveTaskLite14() {
        val result = checkFactsInMathML(
                brushedMathML = "<math mathcolor=\"#7F00FF\" xmlns=\"http://www.w3.org/1998/Math/MathML\"><mn>3</mn><mo>+</mo><mn>4</mn><mo>*</mo><mi>c</mi><mi>o</mi><mi>s</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>+</mo><mi>c</mi><mi>o</mi><mi>s</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mn>3</mn><mo>+</mo><mn>4</mn><mo>*</mo><mi>c</mi><mi>o</mi><mi>s</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>+</mo><mi>c</mi><mi>o</mi><mi>s</mi><mo>(</mo><mn>2</mn><mo>*</mo><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>)</mo><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mn>2</mn><mo>+</mo><mn>4</mn><mo>*</mo><mi>c</mi><mi>o</mi><mi>s</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>+</mo><mn>2</mn><mo>*</mo><mi>c</mi><mi>o</mi><msup><mi>s</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mn>2</mn><mo>(</mo><mn>1</mn><mo>+</mo><mi>c</mi><mi>o</mi><mi>s</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><msup><mo>)</mo><mn>2</mn></msup><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mn>2</mn><mo>(</mo><mn>2</mn><mo>*</mo><msup><mi>cos</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><msup><mo>)</mo><mn>2</mn></msup><mo mathvariant=\"bold\" mathcolor=\"#FF0000\">=</mo><mn>8</mn><mo>*</mo><mo>(</mo><mi>c</mi><mi>o</mi><mi>s</mi><mo>(</mo><mi>x</mi><mrow><mo>)</mo><msup><mo>)</mo><mn>4</mn></msup></mrow></math>",
                wellKnownFunctions = wellKnownFunctions,
                expressionTransformationRules = expressionTransformationRules,
                targetFactIdentifier = "EXPRESSION_COMPARISON{(+(3;*(4;cos(*(2;x)));cos(*(4;x))))}{=}{(*(8;^(cos(x);4)))}",
                targetVariablesNames = "",
                additionalFactsIdentifiers = ""
        )

        val logRef = log.getLogInPlainText()

        assert(!result.contains("Error"))
        assert(!result.contains("#FF"))
        Assert.assertEquals("<math xmlns=\"http://www.w3.org/1998/Math/MathML\" mathcolor=\"#7F00FF\"><mn>3</mn><mo>+</mo><mn>4</mn><mo>*</mo><mi>c</mi><mi>o</mi><mi>s</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>+</mo><mi>c</mi><mi>o</mi><mi>s</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mn>3</mn><mo>+</mo><mn>4</mn><mo>*</mo><mi>c</mi><mi>o</mi><mi>s</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>+</mo><mi>c</mi><mi>o</mi><mi>s</mi><mo>(</mo><mn>2</mn><mo>*</mo><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>)</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mn>2</mn><mo>+</mo><mn>4</mn><mo>*</mo><mi>c</mi><mi>o</mi><mi>s</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>+</mo><mn>2</mn><mo>*</mo><mi>c</mi><mi>o</mi><msup><mi>s</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mn>2</mn><mo>(</mo><mn>1</mn><mo>+</mo><mi>c</mi><mi>o</mi><mi>s</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><msup><mo>)</mo><mn>2</mn></msup><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mn>2</mn><mo>(</mo><mn>2</mn><mo>*</mo><msup><mi>cos</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><msup><mo>)</mo><mn>2</mn></msup><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mn>8</mn><mo>*</mo><mo>(</mo><mi>c</mi><mi>o</mi><mi>s</mi><mo>(</mo><mi>x</mi><mrow><mo>)</mo><msup><mo>)</mo><mn>4</mn></msup></mrow></math>", result)
    }

    @Test
    fun proveTaskLite14WrongManualSolution() {
        val result = checkFactsInMathML(
                brushedMathML = "<math mathcolor=\"#7F00FF\" xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo>(</mo><mn>2</mn><mo>*</mo><mo>(</mo><mi>cos</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><msup><mo>)</mo><mn>2</mn></msup><mo>&#xA0;</mo><mo>-</mo><mo>&#xA0;</mo><mn>1</mn><mo>)</mo><mo>=</mo><mo>&#xA0;</mo><mo>(</mo><mn>2</mn><mo>&#xA0;</mo><mo>*</mo><mo>&#xA0;</mo><mo>(</mo><mn>2</mn><mo>&#xA0;</mo><mo>*</mo><mo>&#xA0;</mo><msup><mi>cos</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo>&#xA0;</mo><mo>-</mo><mo>&#xA0;</mo><mn>1</mn><msup><mo>)</mo><mn>2</mn></msup><mo>&#xA0;</mo><mo>-</mo><mo>&#xA0;</mo><mn>1</mn><mo>)</mo></math>",
                wellKnownFunctions = wellKnownFunctions,
                expressionTransformationRules = expressionTransformationRules,
                targetFactIdentifier = "EXPRESSION_COMPARISON{(+(3;*(4;cos(*(2;x)));cos(*(4;x))))}{=}{(*(8;^(cos(x);4)))}",
                targetVariablesNames = "",
                additionalFactsIdentifiers = ""
        )

        val logRef = log.getLogInPlainText()

        assert(result.contains("Error"))
        assert(result.contains("#FF"))
        Assert.assertEquals("<math xmlns=\"http://www.w3.org/1998/Math/MathML\" mathcolor=\"#7F00FF\"><mo>(</mo><mn>2</mn><mo>*</mo><mo>(</mo><mi>cos</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><msup><mo>)</mo><mn>2</mn></msup><mo>&#xA0;</mo><mo>-</mo><mo>&#xA0;</mo><mn>1</mn><mo>)</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mo>&#xA0;</mo><mo>(</mo><mn>2</mn><mo>&#xA0;</mo><mo>*</mo><mo>&#xA0;</mo><mo>(</mo><mn>2</mn><mo>&#xA0;</mo><mo>*</mo><mo>&#xA0;</mo><msup><mi>cos</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo>&#xA0;</mo><mo>-</mo><mo>&#xA0;</mo><mn>1</mn><msup><mo>)</mo><mn>2</mn></msup><mo>&#xA0;</mo><mo>-</mo><mo>&#xA0;</mo><mn>1</mn><mo>)</mo><mspace linebreak=\"newline\"/><mtext mathvariant=\"bold\" mathcolor=\"#FF0000\">Error: Unclear transformation between 'AND_NODE(facts chains:(((+(*(2;^(cos(*(2;x));2));-(1)));=;(+(*(2;^(+(*(2;^(cos(x);2));-(1));2));-(1)))))out:((+(*(2;^(cos(*(2;x));2));-(1)));=;(+(*(2;^(+(*(2;^(cos(x);2));-(1));2));-(1)))))' and 'AND_NODE(in:((+(3;*(4;cos(*(2;x)));cos(*(4;x))));=;(*(8;^(cos(x);4)))))' </mtext></math>",
                result)
    }

    @Test
    fun proveTaskLite14WrongCheatingSolution() {
        val result = checkFactsInMathML(
                brushedMathML = "<math mathcolor=\"#7F00FF\" xmlns=\"http://www.w3.org/1998/Math/MathML\"><mn>3</mn><mo>+</mo><mn>4</mn><mo>*</mo><mi>c</mi><mi>o</mi><mi>s</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>+</mo><mi>c</mi><mi>o</mi><mi>s</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>=</mo><mn>8</mn><mo>*</mo><mi>c</mi><mi>o</mi><msup><mi>s</mi><mn>4</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo></math>",
                wellKnownFunctions = wellKnownFunctions,
                expressionTransformationRules = expressionTransformationRules,
                targetFactIdentifier = "EXPRESSION_COMPARISON{(+(3;*(4;cos(*(2;x)));cos(*(4;x))))}{=}{(*(8;^(cos(x);4)))}",
                targetVariablesNames = "",
                additionalFactsIdentifiers = ""
        )

        val logRef = log.getLogInPlainText()

        assert(result.contains("Error"))
        assert(result.contains("#FF"))
        Assert.assertEquals("<math xmlns=\"http://www.w3.org/1998/Math/MathML\" mathcolor=\"#7F00FF\"><mn>3</mn><mo>+</mo><mn>4</mn><mo>*</mo><mi>c</mi><mi>o</mi><mi>s</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>+</mo><mi>c</mi><mi>o</mi><mi>s</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mrow mathvariant=\"bold\" mathcolor=\"#FF0000\"><mo>=</mo></mrow><mn>8</mn><mo>*</mo><mi>c</mi><mi>o</mi><msup><mi>s</mi><mn>4</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><mspace linebreak=\"newline\"/><mtext mathvariant=\"bold\" mathcolor=\"#FF0000\">Error: Unclear transformation between '(+(3;*(4;cos(*(2;x)));cos(*(4;x))))' and '(*(8;^(cos(x);4)))' </mtext></math>",
                result)
    }

    @Test
    fun proveTaskLite14SpaceAliases() {
        val result = checkFactsInMathML(
                brushedMathML = "<math mathcolor=\"#7F00FF\" xmlns=\"http://www.w3.org/1998/Math/MathML\"><mn>3</mn><mo>&#x2000;</mo><mo>+</mo><mo>&#x2008;</mo><mo>&#x2009;</mo><mn>4</mn><mo>*</mo><mi>c</mi><mi>o</mi><mi>s</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>+</mo><mi>c</mi><mi>o</mi><mi>s</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>=</mo><mn>8</mn><mo>*</mo><mi>c</mi><mi>o</mi><msup><mi>s</mi><mn>4</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo></math>",
                wellKnownFunctions = wellKnownFunctions,
                expressionTransformationRules = expressionTransformationRules,
                targetFactIdentifier = "EXPRESSION_COMPARISON{(+(3;*(4;cos(*(2;x)));cos(*(4;x))))}{=}{(*(8;^(cos(x);4)))}",
                targetVariablesNames = "",
                additionalFactsIdentifiers = ""
        )

        val logRef = log.getLogInPlainText()

        assert(result.contains("Error"))
        assert(result.contains("#FF"))
        Assert.assertEquals("<math xmlns=\"http://www.w3.org/1998/Math/MathML\" mathcolor=\"#7F00FF\"><mn>3</mn><mo>&#xA0;</mo><mo>+</mo><mo>&#xA0;</mo><mo>&#xA0;</mo><mn>4</mn><mo>*</mo><mi>c</mi><mi>o</mi><mi>s</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>+</mo><mi>c</mi><mi>o</mi><mi>s</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mrow mathvariant=\"bold\" mathcolor=\"#FF0000\"><mo>=</mo></mrow><mn>8</mn><mo>*</mo><mi>c</mi><mi>o</mi><msup><mi>s</mi><mn>4</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><mspace linebreak=\"newline\"/><mtext mathvariant=\"bold\" mathcolor=\"#FF0000\">Error: Unclear transformation between '(+(3;*(4;cos(*(2;x)));cos(*(4;x))))' and '(*(8;^(cos(x);4)))' </mtext></math>",
                result)
    }

    @Test
    fun proveTaskLite17WithAliases() {
        val result = checkFactsInMathML(
                brushedMathML = "<math mathcolor=\"#7F00FF\" xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mn>6</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mn>7</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>&#xA0;</mo><mo mathvariant=\"bold\" mathcolor=\"#FF0000\">=</mo><mspace linebreak=\"newline\"/><mo>(</mo><mi>cos</mi><mo>(</mo><mi mathvariant=\"bold-italic\">x</mi><mo>)</mo><mo>&#xA0;</mo><mo>+</mo><mo>&#x2009;</mo><mi>cos</mi><mo>(</mo><mn>7</mn><mo>*</mo><mi mathvariant=\"bold-italic\">x</mi><mo>)</mo><mo>)</mo><mo>&#xA0;</mo><mo>+</mo><mo>&#x2009;</mo><mo>(</mo><mi>cos</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi mathvariant=\"bold-italic\">x</mi><mo>)</mo><mo>&#xA0;</mo><mo>+</mo><mo>&#xA0;</mo><mi>cos</mi><mo>(</mo><mn>6</mn><mo>*</mo><mi mathvariant=\"bold-italic\">x</mi><mo>)</mo><mo>)</mo><mo>&#xA0;</mo><mo>=</mo><mo>&#xA0;</mo><mspace linebreak=\"newline\"/><mn>2</mn><mo>&#xA0;</mo><mo>*</mo><mo>&#xA0;</mo><mi>cos</mi><mo>(</mo><mn>4</mn><mo>&#xA0;</mo><mo>*</mo><mo>&#xA0;</mo><mi>x</mi><mo>)</mo><mo>&#xA0;</mo><mo>*</mo><mo>&#xA0;</mo><mi>cos</mi><mo>(</mo><mn>3</mn><mo>*</mo><mo>&#xA0;</mo><mi>x</mi><mo>)</mo><mo>&#xA0;</mo><mo>+</mo><mo>&#xA0;</mo><mn>2</mn><mo>&#xA0;</mo><mo>*</mo><mo>&#xA0;</mo><mi>cos</mi><mo>(</mo><mn>4</mn><mo>&#xA0;</mo><mo>*</mo><mo>&#xA0;</mo><mi>x</mi><mo>)</mo><mo>&#xA0;</mo><mo>*</mo><mo>&#xA0;</mo><mi>cos</mi><mo>(</mo><mo>&#xA0;</mo><mn>2</mn><mo>&#xA0;</mo><mo>*</mo><mo>&#xA0;</mo><mi>x</mi><mo>)</mo><mo>=</mo><mo>&#xA0;</mo><mspace linebreak=\"newline\"/><mn>2</mn><mo>&#xA0;</mo><mo>*</mo><mo>&#xA0;</mo><mi>cos</mi><mo>(</mo><mn>4</mn><mo>&#x2009;</mo><mo>*</mo><mo>&#xA0;</mo><mi>x</mi><mo>)</mo><mo>&#xA0;</mo><mo>*</mo><mo>&#x2009;</mo><mo>(</mo><mi>cos</mi><mo>(</mo><mn>3</mn><mo>&#xA0;</mo><mo>*</mo><mo>&#xA0;</mo><mi>x</mi><mo>)</mo><mo>&#xA0;</mo><mo>+</mo><mo>&#xA0;</mo><mi>cos</mi><mo>&#x2009;</mo><mo>(</mo><mn>2</mn><mo>&#xA0;</mo><mo>*</mo><mo>&#xA0;</mo><mi>x</mi><mo>)</mo><mo>)</mo><mo>&#xA0;</mo><mo>=</mo><mspace linebreak=\"newline\"/><mn>2</mn><mo>&#xA0;</mo><mo>*</mo><mo>&#xA0;</mo><mi>cos</mi><mo>(</mo><mn>4</mn><mo>&#x2009;</mo><mo>*</mo><mo>&#xA0;</mo><mi>x</mi><mo>)</mo><mo>&#xA0;</mo><mo>*</mo><mo>&#xA0;</mo><mn>2</mn><mo>&#xA0;</mo><mo>*</mo><mo>&#x2009;</mo><mi>cos</mi><mo>(</mo><mn>5</mn><mo>&#xA0;</mo><mo>*</mo><mo>&#x2009;</mo><mi>x</mi><mo>&#xA0;</mo><mo>/</mo><mo>&#xA0;</mo><mn>2</mn><mo>)</mo><mo>&#xA0;</mo><mo>*</mo><mo>&#x2009;</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>&#xA0;</mo><mo>/</mo><mo>&#xA0;</mo><mn>2</mn><mo>)</mo><mo>&#xA0;</mo><mo>=</mo><mo>&#xA0;</mo><mspace linebreak=\"newline\"/><mn>4</mn><mo>*</mo><mi>cos</mi><mo>(</mo><mfrac><mi>x</mi><mn>2</mn></mfrac><mo>)</mo><mo>*</mo><mi>cos</mi><mo>(</mo><mfrac><mrow><mn>5</mn><mo>*</mo><mi>x</mi></mrow><mn>2</mn></mfrac><mo>)</mo><mo>*</mo><mi>cos</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo></math>",
                wellKnownFunctions = wellKnownFunctions,
                expressionTransformationRules = expressionTransformationRules,
                targetFactIdentifier = "EXPRESSION_COMPARISON{(+(cos(x);cos(*(2;x));cos(*(6;x));cos(*(7;x))))}{=}{(*(4;cos(/(x;2));cos(/(*(5;x);2));cos(*(4;x))))}",
                targetVariablesNames = "",
                additionalFactsIdentifiers = ""
        )

        val logRef = log.getLogInPlainText()

        assert(!result.contains("Error"))
        assert(!result.contains("#FF"))
        Assert.assertEquals("<math xmlns=\"http://www.w3.org/1998/Math/MathML\" mathcolor=\"#7F00FF\"><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mn>6</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mn>7</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>&#xA0;</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mspace linebreak=\"newline\"/><mo>(</mo><mi>cos</mi><mo>(</mo><mi mathvariant=\"bold-italic\">x</mi><mo>)</mo><mo>&#xA0;</mo><mo>+</mo><mo>&#xA0;</mo><mi>cos</mi><mo>(</mo><mn>7</mn><mo>*</mo><mi mathvariant=\"bold-italic\">x</mi><mo>)</mo><mo>)</mo><mo>&#xA0;</mo><mo>+</mo><mo>&#xA0;</mo><mo>(</mo><mi>cos</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi mathvariant=\"bold-italic\">x</mi><mo>)</mo><mo>&#xA0;</mo><mo>+</mo><mo>&#xA0;</mo><mi>cos</mi><mo>(</mo><mn>6</mn><mo>*</mo><mi mathvariant=\"bold-italic\">x</mi><mo>)</mo><mo>)</mo><mo>&#xA0;</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mo>&#xA0;</mo><mspace linebreak=\"newline\"/><mn>2</mn><mo>&#xA0;</mo><mo>*</mo><mo>&#xA0;</mo><mi>cos</mi><mo>(</mo><mn>4</mn><mo>&#xA0;</mo><mo>*</mo><mo>&#xA0;</mo><mi>x</mi><mo>)</mo><mo>&#xA0;</mo><mo>*</mo><mo>&#xA0;</mo><mi>cos</mi><mo>(</mo><mn>3</mn><mo>*</mo><mo>&#xA0;</mo><mi>x</mi><mo>)</mo><mo>&#xA0;</mo><mo>+</mo><mo>&#xA0;</mo><mn>2</mn><mo>&#xA0;</mo><mo>*</mo><mo>&#xA0;</mo><mi>cos</mi><mo>(</mo><mn>4</mn><mo>&#xA0;</mo><mo>*</mo><mo>&#xA0;</mo><mi>x</mi><mo>)</mo><mo>&#xA0;</mo><mo>*</mo><mo>&#xA0;</mo><mi>cos</mi><mo>(</mo><mo>&#xA0;</mo><mn>2</mn><mo>&#xA0;</mo><mo>*</mo><mo>&#xA0;</mo><mi>x</mi><mo>)</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mo>&#xA0;</mo><mspace linebreak=\"newline\"/><mn>2</mn><mo>&#xA0;</mo><mo>*</mo><mo>&#xA0;</mo><mi>cos</mi><mo>(</mo><mn>4</mn><mo>&#xA0;</mo><mo>*</mo><mo>&#xA0;</mo><mi>x</mi><mo>)</mo><mo>&#xA0;</mo><mo>*</mo><mo>&#xA0;</mo><mo>(</mo><mi>cos</mi><mo>(</mo><mn>3</mn><mo>&#xA0;</mo><mo>*</mo><mo>&#xA0;</mo><mi>x</mi><mo>)</mo><mo>&#xA0;</mo><mo>+</mo><mo>&#xA0;</mo><mi>cos</mi><mo>&#xA0;</mo><mo>(</mo><mn>2</mn><mo>&#xA0;</mo><mo>*</mo><mo>&#xA0;</mo><mi>x</mi><mo>)</mo><mo>)</mo><mo>&#xA0;</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mspace linebreak=\"newline\"/><mn>2</mn><mo>&#xA0;</mo><mo>*</mo><mo>&#xA0;</mo><mi>cos</mi><mo>(</mo><mn>4</mn><mo>&#xA0;</mo><mo>*</mo><mo>&#xA0;</mo><mi>x</mi><mo>)</mo><mo>&#xA0;</mo><mo>*</mo><mo>&#xA0;</mo><mn>2</mn><mo>&#xA0;</mo><mo>*</mo><mo>&#xA0;</mo><mi>cos</mi><mo>(</mo><mn>5</mn><mo>&#xA0;</mo><mo>*</mo><mo>&#xA0;</mo><mi>x</mi><mo>&#xA0;</mo><mo>/</mo><mo>&#xA0;</mo><mn>2</mn><mo>)</mo><mo>&#xA0;</mo><mo>*</mo><mo>&#xA0;</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>&#xA0;</mo><mo>/</mo><mo>&#xA0;</mo><mn>2</mn><mo>)</mo><mo>&#xA0;</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mo>&#xA0;</mo><mspace linebreak=\"newline\"/><mn>4</mn><mo>*</mo><mi>cos</mi><mo>(</mo><mfrac><mi>x</mi><mn>2</mn></mfrac><mo>)</mo><mo>*</mo><mi>cos</mi><mo>(</mo><mfrac><mrow><mn>5</mn><mo>*</mo><mi>x</mi></mrow><mn>2</mn></mfrac><mo>)</mo><mo>*</mo><mi>cos</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo></math>", result)
    }

    @Test
    fun proveTaskLite17ParserProblemAvduchenko() {
        val result = checkFactsInMathML(
                brushedMathML = "<math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mn>6</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mn>7</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>&#xA0;</mo><mo>=</mo><mn>2</mn><mo>&#xA0;</mo><mo>*</mo><menclose mathcolor=\"#7F0000\" notation=\"bottom\"><mpadded lspace=\"+1px\"><mi>cos</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>&#xA0;</mo></mpadded><mo>*</mo><mpadded lspace=\"-4px\"><mo>&#xA0;</mo><mo>&#xA0;</mo><mi>cos</mi><mo>(</mo><mn>3</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>&#xA0;</mo></mpadded><mo>+</mo><mo>&#xA0;</mo><mn>2</mn><mo>*</mo><mi>cos</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>*</mo><mpadded lspace=\"-4px\"><mo>&#xA0;</mo><mo>&#xA0;</mo><mi>cos</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mpadded></menclose><mo>=</mo><mn>4</mn><mo>*</mo><mi>cos</mi><mo>(</mo><mfrac><mi>x</mi><mn>2</mn></mfrac><mo>)</mo><mi>cos</mi><mo>(</mo><mfrac><mrow><mn>5</mn><mo>*</mo><mi>x</mi></mrow><mn>2</mn></mfrac><mo>)</mo><mi>cos</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mspace linebreak=\"newline\"/><mtext mathvariant=\"bold\" mathcolor=\"#FF0000\">Syntax&#xA0;error&#xA0;(underlined): Unknown function tag: 'mpadded' with '2' arguments</mtext></math>",
                wellKnownFunctions = wellKnownFunctions,
                expressionTransformationRules = expressionTransformationRules,
                targetFactIdentifier = "EXPRESSION_COMPARISON{(+(cos(x);cos(*(2;x));cos(*(6;x));cos(*(7;x))))}{=}{(*(4;cos(/(x;2));cos(/(*(5;x);2));cos(*(4;x))))}",
                targetVariablesNames = "",
                additionalFactsIdentifiers = ""
        )

        val logRef = log.getLogInPlainText()

        assert(result.contains("Error"))
        assert(result.contains("#FF"))
        Assert.assertEquals("<math xmlns=\"http://www.w3.org/1998/Math/MathML\" mathcolor=\"#7F00FF\"><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mn>6</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mn>7</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>&#xA0;</mo><mrow mathvariant=\"bold\" mathcolor=\"#FF0000\"><mo>=</mo></mrow><mn>2</mn><mo>&#xA0;</mo><mo>*</mo><mrow><mrow><mi>cos</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>&#xA0;</mo></mrow><mo>*</mo><mrow><mo>&#xA0;</mo><mo>&#xA0;</mo><mi>cos</mi><mo>(</mo><mn>3</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>&#xA0;</mo></mrow><mo>+</mo><mo>&#xA0;</mo><mn>2</mn><mo>*</mo><mi>cos</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>*</mo><mrow><mo>&#xA0;</mo><mo>&#xA0;</mo><mi>cos</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow></mrow><mo>=</mo><mn>4</mn><mo>*</mo><mi>cos</mi><mo>(</mo><mfrac><mi>x</mi><mn>2</mn></mfrac><mo>)</mo><mi>cos</mi><mo>(</mo><mfrac><mrow><mn>5</mn><mo>*</mo><mi>x</mi></mrow><mn>2</mn></mfrac><mo>)</mo><mi>cos</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mspace linebreak=\"newline\"/><mtext mathvariant=\"bold\" mathcolor=\"#FF0000\">Error: Unclear transformation between '(+(cos(x);cos(*(2;x));cos(*(6;x));cos(*(7;x))))' and '(+(*(2;cos(*(4;x));cos(*(3;x)));*(2;cos(*(4;x));cos(*(2;x)))))' </mtext></math>", result)
    }

    @Test
    fun proveTaskLite16OriginalTemplate() {
        val result = checkFactsInMathML(
                brushedMathML = "<math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mfrac><mrow><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo></mrow></mfrac><mo>+</mo><mfrac><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo></mrow><mrow><mi>sin</mi><mstyle displaystyle=\"true\"><mo>(</mo></mstyle><mstyle displaystyle=\"true\"><mi>x</mi></mstyle><mstyle displaystyle=\"true\"><mo>)</mo></mstyle></mrow></mfrac><mo>&#xA0;</mo><mo>=</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>=</mo><mo>&#xA0;</mo><mfrac><mn>2</mn><mrow><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac></math>",
                wellKnownFunctions = wellKnownFunctions,
                expressionTransformationRules = expressionTransformationRules,
                targetFactIdentifier = "EXPRESSION_COMPARISON{(+(/(sin(x);+(1;cos(x)));/(+(1;cos(x));sin(x))))}{=}{(/(2;sin(x)))}",
                targetVariablesNames = "",
                additionalFactsIdentifiers = ""
        )

        val logRef = log.getLogInPlainText()


        assert(result.contains("rror"))
        assert(result.contains("#FF"))
        Assert.assertEquals("<math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mfrac><mrow><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo></mrow></mfrac><mo>+</mo><mfrac><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo></mrow><mrow><mi>sin</mi><mrow><mo>(</mo></mrow><mrow><mi>x</mi></mrow><mrow><mo>)</mo></mrow></mrow></mfrac><mo>&#xA0;</mo><mo>=</mo><menclose mathcolor=\"#7F0000\" notation=\"bottom\"><mo>.</mo><mo>.</mo><mo>.</mo></menclose><mo>=</mo><mo>&#xA0;</mo><mfrac><mn>2</mn><mrow><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mspace linebreak=\"newline\"/><mtext mathvariant=\"bold\" mathcolor=\"#FF0000\">Syntax&#xA0;error&#xA0;(underlined): Unexpected: '.'</mtext></math>",
                result)
    }

    @Test
    fun proveTaskLite16WithComment() {
        val result = checkFactsInMathML(
                brushedMathML = "<math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo>/</mo><mo>*</mo><mi>c</mi><mi>o</mi><mi>m</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi><mo>*</mo><mo>/</mo><mspace linebreak=\"newline\"/><mfrac><mrow><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo></mrow></mfrac><mo>+</mo><mfrac><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>&#xA0;</mo><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mfrac><mrow><msup><mi>sin</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo>+</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mrow><mo>^</mo><mn>2</mn><mo>+</mo><mn>2</mn><mo>*</mo><mi>c</mi><mi>os</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mrow><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mfrac><mrow><mn>2</mn><mo>+</mo><mn>2</mn><mo>*</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mo>&#xA0;</mo><mfrac><mn>2</mn><mrow><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac></math>",
                wellKnownFunctions = wellKnownFunctions,
                expressionTransformationRules = expressionTransformationRules,
                targetFactIdentifier = "EXPRESSION_COMPARISON{(+(/(sin(x);+(1;cos(x)));/(+(1;cos(x));sin(x))))}{=}{(/(2;sin(x)))}",
                targetVariablesNames = "",
                additionalFactsIdentifiers = ""
        )

        val logRef = log.getLogInPlainText()


        assert(!result.contains("rror"))
        assert(!result.contains("#FF"))
        Assert.assertEquals("<math xmlns=\"http://www.w3.org/1998/Math/MathML\" mathcolor=\"#7F00FF\"><mo>/</mo><mo>*</mo><mi>c</mi><mi>o</mi><mi>m</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi><mo>*</mo><mo>/</mo><mspace linebreak=\"newline\"/><mfrac><mrow><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo></mrow></mfrac><mo>+</mo><mfrac><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>&#xA0;</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mfrac><mrow><msup><mi>sin</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo>+</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mrow><mo>^</mo><mn>2</mn><mo>+</mo><mn>2</mn><mo>*</mo><mi>c</mi><mi>os</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mrow><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mfrac><mrow><mn>2</mn><mo>+</mo><mn>2</mn><mo>*</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mo>&#xA0;</mo><mfrac><mn>2</mn><mrow><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac></math>",
                result)
    }

    @Test
    fun proveTaskLite16WithCommentWithEqualSign() {
        val result = checkFactsInMathML(
                brushedMathML = "<math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo>/</mo><mo>*</mo><mi>c</mi><mi>o</mi><mi>m</mi><mo>=</mo><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi><mo>*</mo><mo>/</mo><mspace linebreak=\"newline\"/><mfrac><mrow><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo></mrow></mfrac><mo>+</mo><mfrac><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>&#xA0;</mo><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mfrac><mrow><msup><mi>sin</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo>+</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mrow><mo>^</mo><mn>2</mn><mo>+</mo><mn>2</mn><mo>*</mo><mi>c</mi><mi>os</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mrow><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mfrac><mrow><mn>2</mn><mo>+</mo><mn>2</mn><mo>*</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mo>&#xA0;</mo><mfrac><mn>2</mn><mrow><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac></math>",
                wellKnownFunctions = wellKnownFunctions,
                expressionTransformationRules = expressionTransformationRules,
                targetFactIdentifier = "EXPRESSION_COMPARISON{(+(/(sin(x);+(1;cos(x)));/(+(1;cos(x));sin(x))))}{=}{(/(2;sin(x)))}",
                targetVariablesNames = "",
                additionalFactsIdentifiers = ""
        )

        val logRef = log.getLogInPlainText()


        assert(!result.contains("rror"))
        assert(!result.contains("#FF"))
        Assert.assertEquals("<math xmlns=\"http://www.w3.org/1998/Math/MathML\" mathcolor=\"#7F00FF\"><mo>/</mo><mo>*</mo><mi>c</mi><mi>o</mi><mi>m</mi><mo>=</mo><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi><mo>*</mo><mo>/</mo><mspace linebreak=\"newline\"/><mfrac><mrow><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo></mrow></mfrac><mo>+</mo><mfrac><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>&#xA0;</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mfrac><mrow><msup><mi>sin</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo>+</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mrow><mo>^</mo><mn>2</mn><mo>+</mo><mn>2</mn><mo>*</mo><mi>c</mi><mi>os</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mrow><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mfrac><mrow><mn>2</mn><mo>+</mo><mn>2</mn><mo>*</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mo>&#xA0;</mo><mfrac><mn>2</mn><mrow><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac></math>",
                result)
    }

    @Test
    fun proveTaskLite16CheatingCorrectIfDegreeAllowedWithRules() {
        val result = checkFactsInMathML(
                brushedMathML = "<math mathcolor=\"#7F00FF\" xmlns=\"http://www.w3.org/1998/Math/MathML\"><mfrac><mrow><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo></mrow></mfrac><mo>+</mo><mfrac><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mfrac><mrow><msup><mi>sin</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo>+</mo><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><msup><mo>)</mo><mn>2</mn></msup></mrow><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>&#xA0;</mo><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mo>&#xA0;</mo><mfrac><mn>2</mn><mrow><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac></math>",
                wellKnownFunctions = wellKnownFunctions,
                expressionTransformationRules = expressionTransformationRules,
                targetFactIdentifier = "EXPRESSION_COMPARISON{(+(/(sin(x);+(1;cos(x)));/(+(1;cos(x));sin(x))))}{=}{(/(2;sin(x)))}",
                targetVariablesNames = "",
                additionalFactsIdentifiers = ""
        )

        val logRef = log.getLogInPlainText()


        assert(!result.contains("rror"))
        assert(!result.contains("#FF"))
        Assert.assertEquals("<math xmlns=\"http://www.w3.org/1998/Math/MathML\" mathcolor=\"#7F00FF\"><mfrac><mrow><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo></mrow></mfrac><mo>+</mo><mfrac><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mfrac><mrow><msup><mi>sin</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo>+</mo><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><msup><mo>)</mo><mn>2</mn></msup></mrow><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>&#xA0;</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mo>&#xA0;</mo><mfrac><mn>2</mn><mrow><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac></math>",
                result)
    }

    @Test
    fun proveTaskLite16CheatingUnCorrectIfDegreeNotAllowedWithRules() {
        val result = checkFactsInMathML(
                brushedMathML = "<math mathcolor=\"#7F00FF\" xmlns=\"http://www.w3.org/1998/Math/MathML\"><mfrac><mrow><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo></mrow></mfrac><mo>+</mo><mfrac><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mfrac><mrow><msup><mi>sin</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo>+</mo><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><msup><mo>)</mo><mn>2</mn></msup></mrow><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>&#xA0;</mo><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mo>&#xA0;</mo><mfrac><mn>2</mn><mrow><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac></math>",
                wellKnownFunctions = wellKnownFunctions,
                expressionTransformationRules = expressionTransformationRules,
                targetFactIdentifier = "EXPRESSION_COMPARISON{(+(/(sin(x);+(1;cos(x)));/(+(1;cos(x));sin(x))))}{=}{(/(2;sin(x)))}",
                targetVariablesNames = "",
                additionalFactsIdentifiers = "",
                unlimitedWellKnownFunctions = wellKnownFunctionsWithoutDegree
        )

        val logRef = log.getLogInPlainText()


        assert(result.contains("Error"))
        assert(result.contains("#FF"))
        Assert.assertEquals("<math xmlns=\"http://www.w3.org/1998/Math/MathML\" mathcolor=\"#7F00FF\"><mfrac><mrow><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo></mrow></mfrac><mo>+</mo><mfrac><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mfrac><mrow><msup><mi>sin</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo>+</mo><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><msup><mo>)</mo><mn>2</mn></msup></mrow><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>&#xA0;</mo><mrow mathvariant=\"bold\" mathcolor=\"#FF0000\"><mo>=</mo></mrow><mo>&#xA0;</mo><mfrac><mn>2</mn><mrow><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mspace linebreak=\"newline\"/><mtext mathvariant=\"bold\" mathcolor=\"#FF0000\">Error: Unclear transformation between '(/(+(^(sin(x);2);^(+(1;cos(x));2));*(+(1;cos(x));sin(x))))' and '(/(2;sin(x)))' </mtext></math>",
                result)
    }

    @Test
    fun proveTaskLite16TooShortSolutionIfDegreeNotAllowedWithRules() {
        val result = checkFactsInMathML(
                brushedMathML = "<math mathcolor=\"#7F00FF\" xmlns=\"http://www.w3.org/1998/Math/MathML\"><mfrac><mrow><msup><mi>sin</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo>+</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mrow><mo>^</mo><mn>2</mn><mo>+</mo><mn>2</mn><mo>*</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mrow><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mo>&#xA0;</mo><mfrac><mn>2</mn><mrow><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac></math>",
                wellKnownFunctions = wellKnownFunctions,
                expressionTransformationRules = "cos(x)^2+sin(x)^2${configSeparator}1",
                targetFactIdentifier = "EXPRESSION_COMPARISON{(+(/(sin(x);+(1;cos(x)));/(+(1;cos(x));sin(x))))}{=}{(/(2;sin(x)))}",
                targetVariablesNames = "",
                additionalFactsIdentifiers = "",
                unlimitedWellKnownFunctions = wellKnownFunctionsWithoutDegree
        )

        val logRef = log.getLogInPlainText()


        assert(result.contains("Error"))
        assert(result.contains("#FF"))
        Assert.assertEquals("<math xmlns=\"http://www.w3.org/1998/Math/MathML\" mathcolor=\"#7F00FF\"><mfrac><mrow><msup><mi>sin</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo>+</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mrow><mo>^</mo><mn>2</mn><mo>+</mo><mn>2</mn><mo>*</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mrow><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mrow mathvariant=\"bold\" mathcolor=\"#FF0000\"><mo>=</mo></mrow><mo>&#xA0;</mo><mfrac><mn>2</mn><mrow><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mspace linebreak=\"newline\"/><mtext mathvariant=\"bold\" mathcolor=\"#FF0000\">Error: Unclear transformation between '(/(+(^(sin(x);2);1;^(cos(x);2);*(2;cos(x)));*(+(1;cos(x));sin(x))))' and '(/(2;sin(x)))' </mtext></math>",
                result)
    }

    @Test
    fun proveTaskLite13NumericWithConditionChangedAdditions() {
        val result = checkFactsInMathML(
                brushedMathML = "<math mathcolor=\"#7F00FF\" xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo>[</mo><mi>t</mi><mi>g</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mn>4</mn><mo>]</mo><mspace linebreak=\"newline\"/><mo>[</mo><mi>sin</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mn>2</mn><mo>*</mo><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>*</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mfrac><mrow><mn>2</mn><mo>*</mo><mi>t</mi><mi>g</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>*</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>*</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow><mn>1</mn></mfrac><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mn>2</mn><mo>*</mo><mi>tg</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>*</mo><msup><mi>cos</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo mathvariant=\"bold\" mathcolor=\"#FF0000\">=</mo><mn>2</mn><mo>*</mo><mi>tg</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>*</mo><mfrac><mn>1</mn><mrow><mn>1</mn><mo>+</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>=</mo><mfrac><mrow><mn>2</mn><mo>*</mo><mi>tg</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow><mrow><mn>1</mn><mo>+</mo><msup><mi>tg</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>]</mo><mspace linebreak=\"newline\"/><mo>[</mo><mi>cos</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>=</mo><mn>2</mn><mo>*</mo><msup><mi>cos</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo>-</mo><mn>1</mn><mo>=</mo><mn>2</mn><mo>*</mo><mfrac><mn>1</mn><mrow><msup><mi>tg</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo>+</mo><mn>1</mn></mrow></mfrac><mo>-</mo><mn>1</mn><mo>=</mo><mfrac><mrow><mn>1</mn><mo>-</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo></mrow><mrow><mn>1</mn><mo>+</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>]</mo><mspace linebreak=\"newline\"/><mi>sin</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>*</mo><mi>c</mi><mi>t</mi><mi>g</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>=</mo><mi>sin</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>/</mo><mi>t</mi><mi>g</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>=</mo><mi>sin</mi><mo>(</mo><mn>2</mn><mo>*</mo><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>/</mo><mn>4</mn><mo>=</mo><mfrac><mrow><mn>2</mn><mo>*</mo><mi>t</mi><mi>g</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow><mrow><mn>1</mn><mo>+</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>+</mo><mi>cos</mi><mo>(</mo><mn>2</mn><mo>*</mo><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>)</mo><mo>/</mo><mn>4</mn><mo>=</mo><mfrac><mrow><mn>2</mn><mo>*</mo><mi>t</mi><mi>g</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow><mrow><mn>1</mn><mo>+</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>+</mo><mfrac><mrow><mn>1</mn><mo>-</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow><mrow><mn>1</mn><mo>+</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>/</mo><mn>4</mn><mo>=</mo><mspace linebreak=\"newline\"/><mo>=</mo><mfrac><mrow><mn>2</mn><mo>*</mo><mn>4</mn></mrow><mrow><mn>1</mn><mo>+</mo><msup><mn>4</mn><mn>2</mn></msup></mrow></mfrac><mo>+</mo><mfrac><mrow><mn>1</mn><mo>-</mo><msup><mn>4</mn><mn>2</mn></msup></mrow><mrow><mn>1</mn><mo>+</mo><msup><mn>4</mn><mn>2</mn></msup></mrow></mfrac><mo>/</mo><mn>4</mn><mo>=</mo><mn>1</mn><mo>/</mo><mn>4</mn></math>",
                wellKnownFunctions = wellKnownFunctions,
                expressionTransformationRules = expressionTransformationRules,
                targetFactIdentifier = "EXPRESSION_COMPARISON{(+(sin(*(4;x));*(cos(*(4;x));ctg(*(2;x)))))}{=}{(0.25)}",
                targetVariablesNames = "",
                additionalFactsIdentifiers = "EXPRESSION_COMPARISON{(tg(*(2;x)))}{=}{(4)}",
                unlimitedWellKnownFunctions = wellKnownFunctionsWithoutDegree
        )

        val logRef = log.getLogInPlainText()


        assert(!result.contains("Error"))
        assert(!result.contains("#FF"))
        Assert.assertEquals("<math xmlns=\"http://www.w3.org/1998/Math/MathML\" mathcolor=\"#7F00FF\"><mo>[</mo><mi>t</mi><mi>g</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mn>4</mn><mo>]</mo><mspace linebreak=\"newline\"/><mo>[</mo><mi>sin</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mn>2</mn><mo>*</mo><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>*</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mfrac><mrow><mn>2</mn><mo>*</mo><mi>t</mi><mi>g</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>*</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>*</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow><mn>1</mn></mfrac><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mn>2</mn><mo>*</mo><mi>tg</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>*</mo><msup><mi>cos</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mn>2</mn><mo>*</mo><mi>tg</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>*</mo><mfrac><mn>1</mn><mrow><mn>1</mn><mo>+</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mfrac><mrow><mn>2</mn><mo>*</mo><mi>tg</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow><mrow><mn>1</mn><mo>+</mo><msup><mi>tg</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>]</mo><mspace linebreak=\"newline\"/><mo>[</mo><mi>cos</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mn>2</mn><mo>*</mo><msup><mi>cos</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo>-</mo><mn>1</mn><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mn>2</mn><mo>*</mo><mfrac><mn>1</mn><mrow><msup><mi>tg</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo>+</mo><mn>1</mn></mrow></mfrac><mo>-</mo><mn>1</mn><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mfrac><mrow><mn>1</mn><mo>-</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo></mrow><mrow><mn>1</mn><mo>+</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>]</mo><mspace linebreak=\"newline\"/><mi>sin</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>*</mo><mi>c</mi><mi>t</mi><mi>g</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mi>sin</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>/</mo><mi>t</mi><mi>g</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mi>sin</mi><mo>(</mo><mn>2</mn><mo>*</mo><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>/</mo><mn>4</mn><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mfrac><mrow><mn>2</mn><mo>*</mo><mi>t</mi><mi>g</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow><mrow><mn>1</mn><mo>+</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>+</mo><mi>cos</mi><mo>(</mo><mn>2</mn><mo>*</mo><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>)</mo><mo>/</mo><mn>4</mn><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mfrac><mrow><mn>2</mn><mo>*</mo><mi>t</mi><mi>g</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow><mrow><mn>1</mn><mo>+</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>+</mo><mfrac><mrow><mn>1</mn><mo>-</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow><mrow><mn>1</mn><mo>+</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>/</mo><mn>4</mn><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mspace linebreak=\"newline\"/><mo>=</mo><mfrac><mrow><mn>2</mn><mo>*</mo><mn>4</mn></mrow><mrow><mn>1</mn><mo>+</mo><msup><mn>4</mn><mn>2</mn></msup></mrow></mfrac><mo>+</mo><mfrac><mrow><mn>1</mn><mo>-</mo><msup><mn>4</mn><mn>2</mn></msup></mrow><mrow><mn>1</mn><mo>+</mo><msup><mn>4</mn><mn>2</mn></msup></mrow></mfrac><mo>/</mo><mn>4</mn><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mn>1</mn><mo>/</mo><mn>4</mn></math>",
                result)
    }

    @Test
    fun proveTaskLite13WithComment() {
        val result = checkFactsInMathML(
                brushedMathML = "<math mathcolor=\"#7F00FF\" xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo>[</mo><mi>t</mi><mi>g</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mn>4</mn><mo>]</mo><mspace linebreak=\"newline\"/><mo>[</mo><mi>sin</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mn>2</mn><mo>*</mo><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>*</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mfrac><mrow><mn>2</mn><mo>*</mo><mi>t</mi><mi>g</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>*</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>*</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow><mn>1</mn></mfrac><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mn>2</mn><mo>*</mo><mi>tg</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>*</mo><msup><mi>cos</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mn>2</mn><mo>*</mo><mi>tg</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>*</mo><mfrac><mn>1</mn><mrow><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo>+</mo><mn>1</mn></mrow></mfrac><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mfrac><mrow><mn>2</mn><mo>*</mo><mi>tg</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow><mrow><mn>1</mn><mo>+</mo><msup><mi>tg</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>]</mo><mspace linebreak=\"newline\"/><mo>[</mo><mi>cos</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mn>2</mn><mo>*</mo><msup><mi>cos</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo>-</mo><mn>1</mn><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mn>2</mn><mo>*</mo><mfrac><mn>1</mn><mrow><msup><mi>tg</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo>+</mo><mn>1</mn></mrow></mfrac><mo>-</mo><mn>1</mn><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mfrac><mrow><mn>1</mn><mo>-</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo></mrow><mrow><mn>1</mn><mo>+</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>]</mo><mspace linebreak=\"newline\"/><mo>/</mo><mo>*</mo><mi>c</mi><mi>o</mi><mi>m</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi><mo>*</mo><mo>/</mo><mspace linebreak=\"newline\"/><mi>sin</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>*</mo><mi>c</mi><mi>t</mi><mi>g</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo mathvariant=\"bold\" mathcolor=\"#FF0000\">=</mo><mi>sin</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>/</mo><mi>t</mi><mi>g</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>=</mo><mi>sin</mi><mo>(</mo><mn>2</mn><mo>*</mo><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>/</mo><mn>4</mn><mo>=</mo><mfrac><mrow><mn>2</mn><mo>*</mo><mi>t</mi><mi>g</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow><mrow><mn>1</mn><mo>+</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>+</mo><mi>cos</mi><mo>(</mo><mn>2</mn><mo>*</mo><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>)</mo><mo>/</mo><mn>4</mn><mo>=</mo><mfrac><mrow><mn>2</mn><mo>*</mo><mi>t</mi><mi>g</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow><mrow><mn>1</mn><mo>+</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>+</mo><mfrac><mrow><mn>1</mn><mo>-</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow><mrow><mn>1</mn><mo>+</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>/</mo><mn>4</mn><mo>=</mo><mspace linebreak=\"newline\"/><mo>=</mo><mfrac><mrow><mn>2</mn><mo>*</mo><mn>4</mn></mrow><mrow><mn>1</mn><mo>+</mo><msup><mn>4</mn><mn>2</mn></msup></mrow></mfrac><mo>+</mo><mfrac><mrow><mn>1</mn><mo>-</mo><msup><mn>4</mn><mn>2</mn></msup></mrow><mrow><mn>1</mn><mo>+</mo><msup><mn>4</mn><mn>2</mn></msup></mrow></mfrac><mo>/</mo><mn>4</mn><mo>=</mo><mn>1</mn><mo>/</mo><mn>4</mn><mspace linebreak=\"newline\"/><mtext mathvariant=\"bold\" mathcolor=\"#FF0000\">Error: Unclear transformation or incomplete solution. Try to fix errors or to write more details.</mtext></math>",
                wellKnownFunctions = wellKnownFunctions,
                expressionTransformationRules = expressionTransformationRules,
                targetFactIdentifier = "EXPRESSION_COMPARISON{(+(sin(*(4;x));*(cos(*(4;x));ctg(*(2;x)))))}{=}{(0.25)}",
                targetVariablesNames = "",
                additionalFactsIdentifiers = "EXPRESSION_COMPARISON{(tg(*(2;x)))}{=}{(4)}",
                unlimitedWellKnownFunctions = wellKnownFunctionsWithoutDegree
        )

        val logRef = log.getLogInPlainText()


        assert(!result.contains("Error"))
        assert(!result.contains("#FF"))
        Assert.assertEquals("<math xmlns=\"http://www.w3.org/1998/Math/MathML\" mathcolor=\"#7F00FF\"><mo>[</mo><mi>t</mi><mi>g</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mn>4</mn><mo>]</mo><mspace linebreak=\"newline\"/><mo>[</mo><mi>sin</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mn>2</mn><mo>*</mo><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>*</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mfrac><mrow><mn>2</mn><mo>*</mo><mi>t</mi><mi>g</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>*</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>*</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow><mn>1</mn></mfrac><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mn>2</mn><mo>*</mo><mi>tg</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>*</mo><msup><mi>cos</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mn>2</mn><mo>*</mo><mi>tg</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>*</mo><mfrac><mn>1</mn><mrow><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo>+</mo><mn>1</mn></mrow></mfrac><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mfrac><mrow><mn>2</mn><mo>*</mo><mi>tg</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow><mrow><mn>1</mn><mo>+</mo><msup><mi>tg</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>]</mo><mspace linebreak=\"newline\"/><mo>[</mo><mi>cos</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mn>2</mn><mo>*</mo><msup><mi>cos</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo>-</mo><mn>1</mn><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mn>2</mn><mo>*</mo><mfrac><mn>1</mn><mrow><msup><mi>tg</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo>+</mo><mn>1</mn></mrow></mfrac><mo>-</mo><mn>1</mn><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mfrac><mrow><mn>1</mn><mo>-</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo></mrow><mrow><mn>1</mn><mo>+</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>]</mo><mspace linebreak=\"newline\"/><mo>/</mo><mo>*</mo><mi>c</mi><mi>o</mi><mi>m</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi><mo>*</mo><mo>/</mo><mspace linebreak=\"newline\"/><mi>sin</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>*</mo><mi>c</mi><mi>t</mi><mi>g</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mi>sin</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>/</mo><mi>t</mi><mi>g</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mi>sin</mi><mo>(</mo><mn>2</mn><mo>*</mo><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>/</mo><mn>4</mn><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mfrac><mrow><mn>2</mn><mo>*</mo><mi>t</mi><mi>g</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow><mrow><mn>1</mn><mo>+</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>+</mo><mi>cos</mi><mo>(</mo><mn>2</mn><mo>*</mo><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>)</mo><mo>/</mo><mn>4</mn><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mfrac><mrow><mn>2</mn><mo>*</mo><mi>t</mi><mi>g</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow><mrow><mn>1</mn><mo>+</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>+</mo><mfrac><mrow><mn>1</mn><mo>-</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow><mrow><mn>1</mn><mo>+</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>/</mo><mn>4</mn><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mspace linebreak=\"newline\"/><mo>=</mo><mfrac><mrow><mn>2</mn><mo>*</mo><mn>4</mn></mrow><mrow><mn>1</mn><mo>+</mo><msup><mn>4</mn><mn>2</mn></msup></mrow></mfrac><mo>+</mo><mfrac><mrow><mn>1</mn><mo>-</mo><msup><mn>4</mn><mn>2</mn></msup></mrow><mrow><mn>1</mn><mo>+</mo><msup><mn>4</mn><mn>2</mn></msup></mrow></mfrac><mo>/</mo><mn>4</mn><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mn>1</mn><mo>/</mo><mn>4</mn></math>",
                result)
    }

    @Test
    fun proveTaskLite13NumericWithCondition() {
        val result = checkFactsInMathML(
                brushedMathML = "<math mathcolor=\"#7F00FF\" xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo>[</mo><mi>t</mi><mi>g</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mn>4</mn><mo>]</mo><mspace linebreak=\"newline\"/><mo>[</mo><mi>sin</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mn>2</mn><mo>*</mo><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>*</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mfrac><mrow><mn>2</mn><mo>*</mo><mi>t</mi><mi>g</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>*</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>*</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow><mn>1</mn></mfrac><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mn>2</mn><mo>*</mo><mi>tg</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>*</mo><msup><mi>cos</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mn>2</mn><mo>*</mo><mi>tg</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>*</mo><mfrac><mn>1</mn><mrow><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo>+</mo><mn>1</mn></mrow></mfrac><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mfrac><mrow><mn>2</mn><mo>*</mo><mi>tg</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow><mrow><mn>1</mn><mo>+</mo><msup><mi>tg</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>]</mo><mspace linebreak=\"newline\"/><mo>[</mo><mi>cos</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mn>2</mn><mo>*</mo><msup><mi>cos</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo>-</mo><mn>1</mn><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mn>2</mn><mo>*</mo><mfrac><mn>1</mn><mrow><msup><mi>tg</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo>+</mo><mn>1</mn></mrow></mfrac><mo>-</mo><mn>1</mn><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mfrac><mrow><mn>1</mn><mo>-</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo></mrow><mrow><mn>1</mn><mo>+</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>]</mo><mspace linebreak=\"newline\"/><mi>sin</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>*</mo><mi>c</mi><mi>t</mi><mi>g</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mi>sin</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>/</mo><mi>t</mi><mi>g</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mi>sin</mi><mo>(</mo><mn>2</mn><mo>*</mo><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>/</mo><mn>4</mn><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mfrac><mrow><mn>2</mn><mo>*</mo><mi>t</mi><mi>g</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow><mrow><mn>1</mn><mo>+</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>+</mo><mi>cos</mi><mo>(</mo><mn>2</mn><mo>*</mo><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>)</mo><mo>/</mo><mn>4</mn><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mfrac><mrow><mn>2</mn><mo>*</mo><mi>t</mi><mi>g</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow><mrow><mn>1</mn><mo>+</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>+</mo><mfrac><mrow><mn>1</mn><mo>-</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow><mrow><mn>1</mn><mo>+</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>/</mo><mn>4</mn><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mspace linebreak=\"newline\"/><mo>=</mo><mfrac><mrow><mn>2</mn><mo>*</mo><mn>4</mn></mrow><mrow><mn>1</mn><mo>+</mo><msup><mn>4</mn><mn>2</mn></msup></mrow></mfrac><mo>+</mo><mfrac><mrow><mn>1</mn><mo>-</mo><msup><mn>4</mn><mn>2</mn></msup></mrow><mrow><mn>1</mn><mo>+</mo><msup><mn>4</mn><mn>2</mn></msup></mrow></mfrac><mo>/</mo><mn>4</mn><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mn>1</mn><mo>/</mo><mn>4</mn></math>",
                wellKnownFunctions = wellKnownFunctions,
                expressionTransformationRules = expressionTransformationRules,
                targetFactIdentifier = "EXPRESSION_COMPARISON{(+(sin(*(4;x));*(cos(*(4;x));ctg(*(2;x)))))}{=}{(0.25)}",
                targetVariablesNames = "",
                additionalFactsIdentifiers = "EXPRESSION_COMPARISON{(tg(*(2;x)))}{=}{(4)}",
                unlimitedWellKnownFunctions = wellKnownFunctionsWithoutDegree
        )

        val logRef = log.getLogInPlainText()


        assert(!result.contains("Error"))
        assert(!result.contains("#FF"))
        Assert.assertEquals("<math xmlns=\"http://www.w3.org/1998/Math/MathML\" mathcolor=\"#7F00FF\"><mo>[</mo><mi>t</mi><mi>g</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mn>4</mn><mo>]</mo><mspace linebreak=\"newline\"/><mo>[</mo><mi>sin</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mn>2</mn><mo>*</mo><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>*</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mfrac><mrow><mn>2</mn><mo>*</mo><mi>t</mi><mi>g</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>*</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>*</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow><mn>1</mn></mfrac><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mn>2</mn><mo>*</mo><mi>tg</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>*</mo><msup><mi>cos</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mn>2</mn><mo>*</mo><mi>tg</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>*</mo><mfrac><mn>1</mn><mrow><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo>+</mo><mn>1</mn></mrow></mfrac><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mfrac><mrow><mn>2</mn><mo>*</mo><mi>tg</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow><mrow><mn>1</mn><mo>+</mo><msup><mi>tg</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>]</mo><mspace linebreak=\"newline\"/><mo>[</mo><mi>cos</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mn>2</mn><mo>*</mo><msup><mi>cos</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo>-</mo><mn>1</mn><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mn>2</mn><mo>*</mo><mfrac><mn>1</mn><mrow><msup><mi>tg</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo>+</mo><mn>1</mn></mrow></mfrac><mo>-</mo><mn>1</mn><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mfrac><mrow><mn>1</mn><mo>-</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo></mrow><mrow><mn>1</mn><mo>+</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>]</mo><mspace linebreak=\"newline\"/><mi>sin</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>*</mo><mi>c</mi><mi>t</mi><mi>g</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mi>sin</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>/</mo><mi>t</mi><mi>g</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mi>sin</mi><mo>(</mo><mn>2</mn><mo>*</mo><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>/</mo><mn>4</mn><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mfrac><mrow><mn>2</mn><mo>*</mo><mi>t</mi><mi>g</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow><mrow><mn>1</mn><mo>+</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>+</mo><mi>cos</mi><mo>(</mo><mn>2</mn><mo>*</mo><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>)</mo><mo>/</mo><mn>4</mn><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mfrac><mrow><mn>2</mn><mo>*</mo><mi>t</mi><mi>g</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow><mrow><mn>1</mn><mo>+</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>+</mo><mfrac><mrow><mn>1</mn><mo>-</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow><mrow><mn>1</mn><mo>+</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>/</mo><mn>4</mn><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mspace linebreak=\"newline\"/><mo>=</mo><mfrac><mrow><mn>2</mn><mo>*</mo><mn>4</mn></mrow><mrow><mn>1</mn><mo>+</mo><msup><mn>4</mn><mn>2</mn></msup></mrow></mfrac><mo>+</mo><mfrac><mrow><mn>1</mn><mo>-</mo><msup><mn>4</mn><mn>2</mn></msup></mrow><mrow><mn>1</mn><mo>+</mo><msup><mn>4</mn><mn>2</mn></msup></mrow></mfrac><mo>/</mo><mn>4</mn><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mn>1</mn><mo>/</mo><mn>4</mn></math>",
                result)
    }

    @Test
    fun proveTaskLite13UseReadyRules() {
        val result = checkFactsInMathML(
                brushedMathML = "<math mathcolor=\"#7F00FF\" xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo>[</mo><mi>t</mi><mi>g</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mn>4</mn><mo>]</mo><mspace linebreak=\"newline\"/><mi>sin</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>*</mo><mi>c</mi><mi>t</mi><mi>g</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mi>sin</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>/</mo><mi>t</mi><mi>g</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mi>sin</mi><mo>(</mo><mn>2</mn><mo>*</mo><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>/</mo><mn>4</mn><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mfrac><mrow><mn>2</mn><mo>*</mo><mi>t</mi><mi>g</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow><mrow><mn>1</mn><mo>+</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>+</mo><mi>cos</mi><mo>(</mo><mn>2</mn><mo>*</mo><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>)</mo><mo>/</mo><mn>4</mn><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mfrac><mrow><mn>2</mn><mo>*</mo><mi>t</mi><mi>g</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow><mrow><mn>1</mn><mo>+</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>+</mo><mfrac><mrow><mn>1</mn><mo>-</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow><mrow><mn>1</mn><mo>+</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>/</mo><mn>4</mn><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mspace linebreak=\"newline\"/><mo>=</mo><mfrac><mrow><mn>2</mn><mo>*</mo><mn>4</mn></mrow><mrow><mn>1</mn><mo>+</mo><msup><mn>4</mn><mn>2</mn></msup></mrow></mfrac><mo>+</mo><mfrac><mrow><mn>1</mn><mo>-</mo><msup><mn>4</mn><mn>2</mn></msup></mrow><mrow><mn>1</mn><mo>+</mo><msup><mn>4</mn><mn>2</mn></msup></mrow></mfrac><mo>/</mo><mn>4</mn><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mn>1</mn><mo>/</mo><mn>4</mn></math>",
                wellKnownFunctions = wellKnownFunctions,
                expressionTransformationRules = expressionTransformationRules,
                targetFactIdentifier = "EXPRESSION_COMPARISON{(+(sin(*(4;x));*(cos(*(4;x));ctg(*(2;x)))))}{=}{(0.25)}",
                targetVariablesNames = "",
                additionalFactsIdentifiers = "EXPRESSION_COMPARISON{(tg(*(2;x)))}{=}{(4)}",
                unlimitedWellKnownFunctions = wellKnownFunctionsWithoutDegree
        )

        val logRef = log.getLogInPlainText()


        assert(!result.contains("Error"))
        assert(!result.contains("#FF"))
        Assert.assertEquals("<math xmlns=\"http://www.w3.org/1998/Math/MathML\" mathcolor=\"#7F00FF\"><mo>[</mo><mi>t</mi><mi>g</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mn>4</mn><mo>]</mo><mspace linebreak=\"newline\"/><mi>sin</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>*</mo><mi>c</mi><mi>t</mi><mi>g</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mi>sin</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>/</mo><mi>t</mi><mi>g</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mi>sin</mi><mo>(</mo><mn>2</mn><mo>*</mo><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>/</mo><mn>4</mn><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mfrac><mrow><mn>2</mn><mo>*</mo><mi>t</mi><mi>g</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow><mrow><mn>1</mn><mo>+</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>+</mo><mi>cos</mi><mo>(</mo><mn>2</mn><mo>*</mo><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>)</mo><mo>/</mo><mn>4</mn><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mfrac><mrow><mn>2</mn><mo>*</mo><mi>t</mi><mi>g</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow><mrow><mn>1</mn><mo>+</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>+</mo><mfrac><mrow><mn>1</mn><mo>-</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow><mrow><mn>1</mn><mo>+</mo><mi>t</mi><msup><mi>g</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>/</mo><mn>4</mn><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mspace linebreak=\"newline\"/><mo>=</mo><mfrac><mrow><mn>2</mn><mo>*</mo><mn>4</mn></mrow><mrow><mn>1</mn><mo>+</mo><msup><mn>4</mn><mn>2</mn></msup></mrow></mfrac><mo>+</mo><mfrac><mrow><mn>1</mn><mo>-</mo><msup><mn>4</mn><mn>2</mn></msup></mrow><mrow><mn>1</mn><mo>+</mo><msup><mn>4</mn><mn>2</mn></msup></mrow></mfrac><mo>/</mo><mn>4</mn><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mn>1</mn><mo>/</mo><mn>4</mn></math>",
                result)
    }

    @Test
    fun proveTaskLite16CheatingCorrectIfDegreeNotAllowedWithRules() {
        val result = checkFactsInMathML(
                brushedMathML = "<math mathcolor=\"#7F00FF\" xmlns=\"http://www.w3.org/1998/Math/MathML\"><mfrac><mrow><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo></mrow></mfrac><mo>+</mo><mfrac><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mfrac><mrow><msup><mi>sin</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo>+</mo><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><msup><mo>)</mo><mn>2</mn></msup></mrow><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>&#xA0;</mo><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mo>&#xA0;</mo><mfrac><mrow><msup><mi>sin</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo>+</mo><mn>1</mn><mo>+</mo><msup><mi>cos</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo>+</mo><mn>2</mn><mo>*</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>&#xA0;</mo><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mo>&#xA0;</mo><mfrac><mrow><mn>2</mn><mo>+</mo><mn>2</mn><mo>*</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mfrac><mn>2</mn><mrow><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac></math>",
                wellKnownFunctions = wellKnownFunctions,
                expressionTransformationRules = expressionTransformationRules,
                targetFactIdentifier = "EXPRESSION_COMPARISON{(+(/(sin(x);+(1;cos(x)));/(+(1;cos(x));sin(x))))}{=}{(/(2;sin(x)))}",
                targetVariablesNames = "",
                additionalFactsIdentifiers = "",
                unlimitedWellKnownFunctions = wellKnownFunctionsWithoutDegree
        )

        val logRef = log.getLogInPlainText()


        assert(!result.contains("Error"))
        assert(!result.contains("#FF"))
        Assert.assertEquals("<math xmlns=\"http://www.w3.org/1998/Math/MathML\" mathcolor=\"#7F00FF\"><mfrac><mrow><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo></mrow></mfrac><mo>+</mo><mfrac><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mfrac><mrow><msup><mi>sin</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo>+</mo><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><msup><mo>)</mo><mn>2</mn></msup></mrow><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>&#xA0;</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mo>&#xA0;</mo><mfrac><mrow><msup><mi>sin</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo>+</mo><mn>1</mn><mo>+</mo><msup><mi>cos</mi><mn>2</mn></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo>+</mo><mn>2</mn><mo>*</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>&#xA0;</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mo>&#xA0;</mo><mfrac><mrow><mn>2</mn><mo>+</mo><mn>2</mn><mo>*</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow><mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mfrac><mn>2</mn><mrow><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac></math>",
                result)
    }

    @Test
    fun proveTaskMiddle1Correct() {
        val result = checkFactsInMathML(
                brushedMathML = "<math mathcolor=\"#7F00FF\" xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>t</mi><mi>g</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>-</mo><mfrac><mn>1</mn><mrow><mi>cos</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>&#xA0;</mo><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mfrac><mrow><mi>sin</mi><mo>(</mo><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>*</mo><mn>2</mn><mo>)</mo><mo>&#xA0;</mo><mo>-</mo><mo>&#xA0;</mo><mn>1</mn></mrow><mrow><mi>cos</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>&#xA0;</mo><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mfrac><mrow><mn>2</mn><mo>*</mo><mi>sin</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>*</mo><mi>cos</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>&#xA0;</mo><mo>-</mo><mo>&#xA0;</mo><mn>1</mn></mrow><mrow><mi>cos</mi><mo>(</mo><mn>2</mn><mo>*</mo><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>)</mo></mrow></mfrac><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mfrac><mrow><mn>2</mn><mo>*</mo><mi>sin</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>*</mo><mi>cos</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>&#xA0;</mo><mo>-</mo><mo>&#xA0;</mo><mn>1</mn></mrow><mrow><msup><mi>cos</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>-</mo><msup><mi>sin</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mspace linebreak=\"newline\"/><mfrac><mrow><mn>2</mn><mo>*</mo><mi>sin</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>*</mo><mi>cos</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>&#xA0;</mo><mo>-</mo><mo>&#xA0;</mo><msup><mi>cos</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>-</mo><msup><mi>sin</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow><mrow><msup><mi>cos</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>-</mo><msup><mi>sin</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo mathvariant=\"bold\" mathcolor=\"#007F00\">=</mo><mfrac><mrow><mo>(</mo><mi>sin</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>-</mo><mi>cos</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>)</mo></mrow><mrow><mo>(</mo><mi>sin</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>)</mo></mrow></mfrac></math>",
                wellKnownFunctions = wellKnownFunctions,
                expressionTransformationRules = expressionTransformationRules,
                targetFactIdentifier = "EXPRESSION_COMPARISON{(+(tg(*(4;x));-(/(1;cos(*(4;x))))))}{=}{(/(+(sin(*(2;x));-(cos(*(2;x))));+(sin(*(2;x));cos(*(2;x)))))}",
                targetVariablesNames = "",
                additionalFactsIdentifiers = "",
                unlimitedWellKnownFunctions = wellKnownFunctionsWithoutDegree
        )

        val logRef = log.getLogInPlainText()


        assert(!result.contains("Error"))
        assert(!result.contains("#FF"))
        Assert.assertEquals("<math xmlns=\"http://www.w3.org/1998/Math/MathML\" mathcolor=\"#7F00FF\"><mi>t</mi><mi>g</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>-</mo><mfrac><mn>1</mn><mrow><mi>cos</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>&#xA0;</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mfrac><mrow><mi>sin</mi><mo>(</mo><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>*</mo><mn>2</mn><mo>)</mo><mo>&#xA0;</mo><mo>-</mo><mo>&#xA0;</mo><mn>1</mn></mrow><mrow><mi>cos</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mo>&#xA0;</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mfrac><mrow><mn>2</mn><mo>*</mo><mi>sin</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>*</mo><mi>cos</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>&#xA0;</mo><mo>-</mo><mo>&#xA0;</mo><mn>1</mn></mrow><mrow><mi>cos</mi><mo>(</mo><mn>2</mn><mo>*</mo><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>)</mo></mrow></mfrac><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mfrac><mrow><mn>2</mn><mo>*</mo><mi>sin</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>*</mo><mi>cos</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>&#xA0;</mo><mo>-</mo><mo>&#xA0;</mo><mn>1</mn></mrow><mrow><msup><mi>cos</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>-</mo><msup><mi>sin</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mspace linebreak=\"newline\"/><mfrac><mrow><mn>2</mn><mo>*</mo><mi>sin</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>*</mo><mi>cos</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>&#xA0;</mo><mo>-</mo><mo>&#xA0;</mo><msup><mi>cos</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>-</mo><msup><mi>sin</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow><mrow><msup><mi>cos</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>-</mo><msup><mi>sin</mi><mn>2</mn></msup><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mfrac><mrow><mo>(</mo><mi>sin</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>-</mo><mi>cos</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>)</mo></mrow><mrow><mo>(</mo><mi>sin</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>)</mo></mrow></mfrac></math>",
                result)
    }

    @Test
    fun proveTaskComlicated1Correct() {
        val result = checkFactsInMathML(
                brushedMathML = "<math mathcolor=\"#7F00FF\" xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo>[</mo><mi>x</mi><mo>+</mo><mi>y</mi><mo>+</mo><mi>z</mi><mo>=</mo><mi mathvariant=\"normal\">&#x3C0;</mi><mo>]</mo><mspace linebreak=\"newline\"/><mo>[</mo><mi>x</mi><mo>+</mo><mi>y</mi><mo>+</mo><mi>z</mi><mo>=</mo><mi mathvariant=\"normal\">&#x3C0;</mi><mo>=</mo><mo>&gt;</mo><mo>(</mo><mi>x</mi><mo>+</mo><mi>y</mi><mo>+</mo><mi>z</mi><mo>)</mo><mo>-</mo><mi>z</mi><mo>=</mo><mi mathvariant=\"normal\">&#x3C0;</mi><mo>-</mo><mi mathvariant=\"normal\">z</mi><mo>=</mo><mo>&gt;</mo><mi>x</mi><mo>+</mo><mi>y</mi><mo>=</mo><mi mathvariant=\"normal\">&#x3C0;</mi><mo>-</mo><mi mathvariant=\"normal\">z</mi><mo>=</mo><mo>&gt;</mo><mfrac><mrow><mi mathvariant=\"normal\">x</mi><mo>+</mo><mi mathvariant=\"normal\">y</mi></mrow><mn>2</mn></mfrac><mo>=</mo><mfrac><mrow><mi mathvariant=\"normal\">&#x3C0;</mi><mo>-</mo><mi mathvariant=\"normal\">z</mi></mrow><mn>2</mn></mfrac><mo>=</mo><mo>&gt;</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>+</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>=</mo><mfrac><mi mathvariant=\"normal\">&#x3C0;</mi><mn>2</mn></mfrac><mo>-</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>]</mo><mspace linebreak=\"newline\"/><mo>[</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>+</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>=</mo><mfrac><mi mathvariant=\"normal\">&#x3C0;</mi><mn>2</mn></mfrac><mo>-</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>=</mo><mo>&gt;</mo><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>+</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo><mo>-</mo><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>+</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>-</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo><mo>=</mo><mo>(</mo><mfrac><mi mathvariant=\"normal\">&#x3C0;</mi><mn>2</mn></mfrac><mo>-</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo><mo>-</mo><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>+</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>-</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo><mo>=</mo><mo>&gt;</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>=</mo><mfrac><mi mathvariant=\"normal\">&#x3C0;</mi><mn>2</mn></mfrac><mo>-</mo><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>+</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo><mo>]</mo><mspace linebreak=\"newline\"/><mi>ctg</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mo>+</mo><mi>ctg</mi><mfenced><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac></mfenced><mo>+</mo><mi>ctg</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo><mo>=</mo><mfrac><mrow><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac><mo>+</mo><mfrac><mrow><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac><mo>+</mo><mfrac><mrow><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac><mo>=</mo><mfrac><mrow><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac><mo>+</mo><mfrac><mrow><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac><mo>=</mo><mfrac><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>+</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac><mo>+</mo><mfrac><mrow><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac><mo>=</mo><mspace linebreak=\"newline\"/><mo>=</mo><mfrac><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">&#x3C0;</mi><mn>2</mn></mfrac><mo>-</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac><mo>+</mo><mfrac><mrow><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac><mo>=</mo><mfrac><mrow><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac><mo>+</mo><mfrac><mrow><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac><mo>=</mo><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo><mfenced><mfrac><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo><mo>+</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac></mfenced><mo>=</mo><mspace linebreak=\"newline\"/><mo>=</mo><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo><mfenced><mfrac><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">&#x3C0;</mi><mn>2</mn></mfrac><mo>-</mo><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>+</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo><mo>)</mo><mo>+</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac></mfenced><mo>=</mo><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo><mfenced><mfrac><mrow><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>+</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo><mo>+</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac></mfenced><mo>=</mo><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo><mfenced><mfrac><mrow><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac></mfenced><mo>=</mo><mi>ctg</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mi>ctg</mi><mfenced><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac></mfenced><mi>ctg</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></math>",
                wellKnownFunctions = wellKnownFunctions,
                expressionTransformationRules = expressionTransformationRules,
                targetFactIdentifier = "EXPRESSION_COMPARISON{(+(ctg(/(x;2));ctg(/(y;2));ctg(/(z;2))))}{=}{(*(ctg(/(x;2));ctg(/(y;2));ctg(/(z;2))))}",
                targetVariablesNames = "",
                additionalFactsIdentifiers = "EXPRESSION_COMPARISON{(+(x;y;z))}{=}{(pi)}",
                unlimitedWellKnownFunctions = wellKnownFunctionsWithoutDegree
        )

        val logRef = log.getLogInPlainText()


        assert(!result.contains("Error"))
        assert(!result.contains("#FF"))
        Assert.assertEquals("<math xmlns=\"http://www.w3.org/1998/Math/MathML\" mathcolor=\"#7F00FF\"><mo>[</mo><mi>x</mi><mo>+</mo><mi>y</mi><mo>+</mo><mi>z</mi><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mi mathvariant=\"normal\">&#x3C0;</mi><mo>]</mo><mspace linebreak=\"newline\"/><mo>[</mo><mi>x</mi><mo>+</mo><mi>y</mi><mo>+</mo><mi>z</mi><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mi mathvariant=\"normal\">&#x3C0;</mi><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo><mo>&gt;</mo></mrow><mo>(</mo><mi>x</mi><mo>+</mo><mi>y</mi><mo>+</mo><mi>z</mi><mo>)</mo><mo>-</mo><mi>z</mi><mo>=</mo><mi mathvariant=\"normal\">&#x3C0;</mi><mo>-</mo><mi mathvariant=\"normal\">z</mi><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo><mo>&gt;</mo></mrow><mi>x</mi><mo>+</mo><mi>y</mi><mo>=</mo><mi mathvariant=\"normal\">&#x3C0;</mi><mo>-</mo><mi mathvariant=\"normal\">z</mi><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo><mo>&gt;</mo></mrow><mfrac><mrow><mi mathvariant=\"normal\">x</mi><mo>+</mo><mi mathvariant=\"normal\">y</mi></mrow><mn>2</mn></mfrac><mo>=</mo><mfrac><mrow><mi mathvariant=\"normal\">&#x3C0;</mi><mo>-</mo><mi mathvariant=\"normal\">z</mi></mrow><mn>2</mn></mfrac><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo><mo>&gt;</mo></mrow><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>+</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>=</mo><mfrac><mi mathvariant=\"normal\">&#x3C0;</mi><mn>2</mn></mfrac><mo>-</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>]</mo><mspace linebreak=\"newline\"/><mo>[</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>+</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mfrac><mi mathvariant=\"normal\">&#x3C0;</mi><mn>2</mn></mfrac><mo>-</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo><mo>&gt;</mo></mrow><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>+</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo><mo>-</mo><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>+</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>-</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo><mo>=</mo><mo>(</mo><mfrac><mi mathvariant=\"normal\">&#x3C0;</mi><mn>2</mn></mfrac><mo>-</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo><mo>-</mo><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>+</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>-</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo><mo>&gt;</mo></mrow><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>=</mo><mfrac><mi mathvariant=\"normal\">&#x3C0;</mi><mn>2</mn></mfrac><mo>-</mo><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>+</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo><mo>]</mo><mspace linebreak=\"newline\"/><mi>ctg</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mo>+</mo><mi>ctg</mi><mfenced><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac></mfenced><mo>+</mo><mi>ctg</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mfrac><mrow><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac><mo>+</mo><mfrac><mrow><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac><mo>+</mo><mfrac><mrow><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mfrac><mrow><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac><mo>+</mo><mfrac><mrow><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mfrac><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>+</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac><mo>+</mo><mfrac><mrow><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mspace linebreak=\"newline\"/><mo>=</mo><mfrac><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">&#x3C0;</mi><mn>2</mn></mfrac><mo>-</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac><mo>+</mo><mfrac><mrow><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mfrac><mrow><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac><mo>+</mo><mfrac><mrow><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo><mfenced><mfrac><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo><mo>+</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac></mfenced><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mspace linebreak=\"newline\"/><mo>=</mo><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo><mfenced><mfrac><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">&#x3C0;</mi><mn>2</mn></mfrac><mo>-</mo><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>+</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo><mo>)</mo><mo>+</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac></mfenced><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo><mfenced><mfrac><mrow><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>+</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo><mo>+</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac></mfenced><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo><mfenced><mfrac><mrow><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac></mfenced><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mi>ctg</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mi>ctg</mi><mfenced><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac></mfenced><mi>ctg</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></math>",
                result)
    }

    @Test
    fun proveTaskMiddle1ExpressionNotEndedError() {
        val result = checkFactsInMathML(
                brushedMathML = "<math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mn>4</mn><mo>*</mo><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">&#x3C0;</mi><mn>6</mn></mfrac><mo>-</mo><mi>x</mi><mo>)</mo><mo>*</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">&#x3C0;</mi><mn>3</mn></mfrac><mo>-</mo><mi>x</mi><mo>)</mo><mo>=</mo><mn>2</mn><mrow><mo>*</mo><mo>(</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">&#x3C0;</mi><mn>2</mn></mfrac><mo>-</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>+</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">&#x3C0;</mi><mn>6</mn></mfrac><mo>)</mo><mo>)</mo><mo>=</mo><mn>2</mn><mo>*</mo><mo>(</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">&#x3C0;</mi><mn>2</mn></mfrac><mo>-</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>+</mo><mn>0</mn><mo>,</mo><mn>5</mn><mo>)</mo></mrow><mo>=</mo><mfrac><mrow><mi>sin</mi><mo>(</mo><mn>3</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mspace linebreak=\"newline\"/><mtext mathvariant=\"bold\" mathcolor=\"#FF0000\">Syntax&#xA0;error&#xA0;(underlined): data not ended</mtext></math>",
                wellKnownFunctions = wellKnownFunctions,
                expressionTransformationRules = expressionTransformationRules,
                targetFactIdentifier = "EXPRESSION_COMPARISON{(*(4;cos(+(/(pi;6);-(x)));sin(+(/(pi;3);-(x)))))}{=}{(/(sin(*(3;x));sin(x)))}",
                targetVariablesNames = "",
                additionalFactsIdentifiers = "",
                unlimitedWellKnownFunctions = wellKnownFunctionsWithoutDegree
        )

        val logRef = log.getLogInPlainText()


        assert(result.contains("Error"))
        assert(result.contains("#FF"))
        Assert.assertEquals("<math xmlns=\"http://www.w3.org/1998/Math/MathML\" mathcolor=\"#7F00FF\"><mn>4</mn><mo>*</mo><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">&#x3C0;</mi><mn>6</mn></mfrac><mo>-</mo><mi>x</mi><mo>)</mo><mo>*</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">&#x3C0;</mi><mn>3</mn></mfrac><mo>-</mo><mi>x</mi><mo>)</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mn>2</mn><mrow><mo>*</mo><mo>(</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">&#x3C0;</mi><mn>2</mn></mfrac><mo>-</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>+</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">&#x3C0;</mi><mn>6</mn></mfrac><mo>)</mo><mo>)</mo><mrow mathvariant=\"bold\" mathcolor=\"#FF0000\"><mo>=</mo></mrow><mn>2</mn><mo>*</mo><mo>(</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">&#x3C0;</mi><mn>2</mn></mfrac><mo>-</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>+</mo><mn>0</mn><mo>,</mo><mn>5</mn><mo>)</mo></mrow><mo>=</mo><mfrac><mrow><mi>sin</mi><mo>(</mo><mn>3</mn><mo>*</mo><mi>x</mi><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mfrac><mspace linebreak=\"newline\"/><mtext mathvariant=\"bold\" mathcolor=\"#FF0000\">Error: Unclear transformation between '(*(2;+(sin(+(/(3.1415926535897932384626433832795;2);-(*(2;x))));sin(/(3.1415926535897932384626433832795;6)))))' and '(*(2;*(sin(+(/(3.1415926535897932384626433832795;2);-(*(2;x))));+(0);5)))' </mtext></math>",
                result)
    }

    @Test
    @Ignore //should be no transformation
    fun incorrectApplicationOfRuleAddEqualExpressionsToBothSides(){
        val compiledConfiguration = compiledConfigurationBySettings(wellKnownFunctions, expressionTransformationRules, "", wellKnownFunctions)
        val factComporator = compiledConfiguration.factComporator

        val factConstructorViewer = FactConstructorViewer()
        val left = factConstructorViewer.constructFactByIdentifier("MAIN_LINE_AND_NODE{RULES{}FACT_TRANSFORMATION_CHAINS{}EXPRESSION_TRANSFORMATION_CHAINS{}IN_FACTS{{MAIN_LINE_AND_NODE{RULES{}FACT_TRANSFORMATION_CHAINS{}EXPRESSION_TRANSFORMATION_CHAINS{}IN_FACTS{{EXPRESSION_COMPARISON{*(2;^(cos(*(2;x));2))}{=}{*(2;^(+(*(2;^(cos(x);2));-(1));2))}}}OUT_FACTS{{EXPRESSION_COMPARISON{*(2;^(cos(*(2;x));2))}{=}{*(2;^(+(*(2;^(cos(x);2));-(1));2))}}}}}}OUT_FACTS{{MAIN_LINE_AND_NODE{RULES{}FACT_TRANSFORMATION_CHAINS{}EXPRESSION_TRANSFORMATION_CHAINS{}IN_FACTS{{EXPRESSION_COMPARISON{*(2;^(cos(*(2;x));2))}{=}{*(2;^(+(*(2;^(cos(x);2));-(1));2))}}}OUT_FACTS{{EXPRESSION_COMPARISON{*(2;^(cos(*(2;x));2))}{=}{*(2;^(+(*(2;^(cos(x);2));-(1));2))}}}}}}}")
        val right = factConstructorViewer.constructFactByIdentifier("MAIN_LINE_AND_NODE{RULES{}FACT_TRANSFORMATION_CHAINS{}EXPRESSION_TRANSFORMATION_CHAINS{}IN_FACTS{{MAIN_LINE_AND_NODE{RULES{}FACT_TRANSFORMATION_CHAINS{}EXPRESSION_TRANSFORMATION_CHAINS{}IN_FACTS{{EXPRESSION_COMPARISON{(+(3;*(4;cos(*(2;x)));cos(*(4;x))))}{=}{(*(8;^(cos(x);4)))}}}OUT_FACTS{{EXPRESSION_COMPARISON{(+(3;*(4;cos(*(2;x)));cos(*(4;x))))}{=}{(*(8;^(cos(x);4)))}}}}}}OUT_FACTS{{MAIN_LINE_AND_NODE{RULES{}FACT_TRANSFORMATION_CHAINS{}EXPRESSION_TRANSFORMATION_CHAINS{}IN_FACTS{{EXPRESSION_COMPARISON{(+(3;*(4;cos(*(2;x)));cos(*(4;x))))}{=}{(*(8;^(cos(x);4)))}}}OUT_FACTS{{EXPRESSION_COMPARISON{(+(3;*(4;cos(*(2;x)));cos(*(4;x))))}{=}{(*(8;^(cos(x);4)))}}}}}}}")
        val result = factComporator.compareWithTreeTransformationRules(left, right, listOf(), compiledConfiguration.compiledFactTreeTransformationRules,
                additionalFactUsed = mutableListOf())
        assert(result,
                { print(log.getLogInPlainText()) })
    }

    @Test
    @Ignore
    fun oldIdentifierToNew() {
        val factConstructorViewer: FactConstructorViewer = FactConstructorViewer()
        val fact = parseFromFactIdentifier("x+y+z;ec;=;ec;pi")!!
        val newIdentifier = factConstructorViewer.constructIdentifierByFact(fact)
        print(newIdentifier)
    }


    @Test
    @Ignore
    fun testReal() {
        val result = checkFactsInMathML(
                "<math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>cos</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mn>2</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mn>6</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mn>7</mn><mo>*</mo><mi>x</mi><mo>)</mo><mo>&#xA0;</mo><mo>=</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>=</mo><mo>&#xA0;</mo><mn>4</mn><mo>*</mo><mi>cos</mi><mo>(</mo><mfrac><mi>x</mi><mn>2</mn></mfrac><mo>)</mo><mi>cos</mi><mo>(</mo><mfrac><mrow><mn>5</mn><mo>*</mo><mi>x</mi></mrow><mn>2</mn></mfrac><mo>)</mo><mi>cos</mi><mo>(</mo><mn>4</mn><mo>*</mo><mi>x</mi><mo>)</mo></math>",
                ";;;0;;;;;;1;;;+;;;-1;;;-;;;-1;;;*;;;-1;;;/;;;-1;;;^;;;-1",
                ";;;0;;;;;;1;;;+;;;-1;;;-;;;-1;;;*;;;-1;;;/;;;-1",
                "sin(x)^2;;;1 - cos(x)^2;;;cos(x)^2;;;1 - sin(x)^2;;;cos(x)^2+sin(x)^2;;;1;;;tg(x);;;sin(x)/cos(x);;;ctg(x);;;cos(x)/sin(x);;;ctg(x)tg(x);;;1;;;tg(x)^2+1;;;1/cos(x)^2;;;ctg(x)^2+1;;;1/sin(x)^2;;;sin(x+y);;;sin(x)cos(y)+sin(y)cos(x);;;sin(x-y);;;sin(x)cos(y)-sin(y)cos(x);;;cos(x+y);;;cos(x)cos(y)-sin(x)sin(y);;;cos(x-y);;;cos(x)cos(y)+sin(x)sin(y);;;tg(x+y);;;(tg(x)+tg(y))/(1-tg(x)tg(y));;;tg(x-y);;;(tg(x)-tg(y))/(1+tg(x)tg(y));;;ctg(x+y);;;(ctg(x)ctg(y)-1)/(ctg(x)+ctg(y));;;ctg(x-y);;;(ctg(x)ctg(y)+1)/(ctg(x)-ctg(y));;;sin(2*x);;;2*sin(x)cos(x);;;cos(2*x);;;cos(x)^2 - sin(x)^2;;;cos(2*x);;;2*cos(x)^2 - 1;;;cos(2*x);;;1 - 2*sin(x)^2;;;sin(x)^2;;;(1 - cos(2*x))/2;;;cos(x)^2;;;(1 + cos(2*x))/2;;;sin(x)+sin(y);;;2*sin((x+y)/2)*cos((x-y)/2);;;sin(x)-sin(y);;;2*sin((x-y)/2)*cos((x+y)/2);;;cos(x)+cos(y);;;2*cos((x+y)/2)*cos((x-y)/2);;;cos(x)-cos(y);;;2*sin((x+y)/2)*sin((x-y)/2);;;sin(x)sin(y);;;(cos(x-y)-cos(x+y))/2;;;sin(x)cos(y);;;(sin(x-y)+sin(x+y))/2;;;cos(x)cos(y);;;(cos(x-y)+cos(x+y))/2;;;sin(0);;;0;;;sin(pi/2);;;1;;;cos(0);;;1;;;cos(pi/2);;;0;;;sin(pi/6);;;1/2;;;sin(pi/4);;;2^0.5/2;;;sin(pi/3);;;3^0.5/2;;;cos(pi/3);;;1/2;;;cos(pi/4);;;2^0.5/2;;;cos(pi/6);;;3^0.5/2;;;cos(pi/6);;;3^0.5/2;;;cos(-x);;;cos(x);;;sin(-x);;;-sin(x);;;sin(pi-x);;;sin(x);;;cos(pi-x);;;-cos(x);;;sin(x+2*pi);;;sin(x);;;cos(x+2*pi);;;cos(x);;;cos(pi/2-x);;;sin(x);;;sin(pi/2-x);;;cos(x)",
                "EXPRESSION_COMPARISON{(+(cos(x);cos(*(2;x));cos(*(6;x));cos(*(7;x))))}{=}{(*(4;cos(/(x;2));cos(/(*(5;x);2));cos(*(4;x))))}",
                "",
                ""
        )

        val logRef = log.getLogInPlainText()


        assert(!result.contains("Error"))
        assert(!result.contains("#FF"))
        Assert.assertEquals("<math xmlns=\"http://www.w3.org/1998/Math/MathML\" mathcolor=\"#7F00FF\"><mo>[</mo><mi>x</mi><mo>+</mo><mi>y</mi><mo>+</mo><mi>z</mi><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mi mathvariant=\"normal\">&#x3C0;</mi><mo>]</mo><mspace linebreak=\"newline\"/><mo>[</mo><mi>x</mi><mo>+</mo><mi>y</mi><mo>+</mo><mi>z</mi><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mi mathvariant=\"normal\">&#x3C0;</mi><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo><mo>&gt;</mo></mrow><mo>(</mo><mi>x</mi><mo>+</mo><mi>y</mi><mo>+</mo><mi>z</mi><mo>)</mo><mo>-</mo><mi>z</mi><mo>=</mo><mi mathvariant=\"normal\">&#x3C0;</mi><mo>-</mo><mi mathvariant=\"normal\">z</mi><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo><mo>&gt;</mo></mrow><mi>x</mi><mo>+</mo><mi>y</mi><mo>=</mo><mi mathvariant=\"normal\">&#x3C0;</mi><mo>-</mo><mi mathvariant=\"normal\">z</mi><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo><mo>&gt;</mo></mrow><mfrac><mrow><mi mathvariant=\"normal\">x</mi><mo>+</mo><mi mathvariant=\"normal\">y</mi></mrow><mn>2</mn></mfrac><mo>=</mo><mfrac><mrow><mi mathvariant=\"normal\">&#x3C0;</mi><mo>-</mo><mi mathvariant=\"normal\">z</mi></mrow><mn>2</mn></mfrac><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo><mo>&gt;</mo></mrow><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>+</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>=</mo><mfrac><mi mathvariant=\"normal\">&#x3C0;</mi><mn>2</mn></mfrac><mo>-</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>]</mo><mspace linebreak=\"newline\"/><mo>[</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>+</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mfrac><mi mathvariant=\"normal\">&#x3C0;</mi><mn>2</mn></mfrac><mo>-</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo><mo>&gt;</mo></mrow><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>+</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo><mo>-</mo><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>+</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>-</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo><mo>=</mo><mo>(</mo><mfrac><mi mathvariant=\"normal\">&#x3C0;</mi><mn>2</mn></mfrac><mo>-</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo><mo>-</mo><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>+</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>-</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo><mo>&gt;</mo></mrow><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>=</mo><mfrac><mi mathvariant=\"normal\">&#x3C0;</mi><mn>2</mn></mfrac><mo>-</mo><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>+</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo><mo>]</mo><mspace linebreak=\"newline\"/><mi>ctg</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mo>+</mo><mi>ctg</mi><mfenced><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac></mfenced><mo>+</mo><mi>ctg</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mfrac><mrow><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac><mo>+</mo><mfrac><mrow><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac><mo>+</mo><mfrac><mrow><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mfrac><mrow><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo><mo>+</mo><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac><mo>+</mo><mfrac><mrow><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mfrac><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>+</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac><mo>+</mo><mfrac><mrow><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mspace linebreak=\"newline\"/><mo>=</mo><mfrac><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">&#x3C0;</mi><mn>2</mn></mfrac><mo>-</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac><mo>+</mo><mfrac><mrow><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mfrac><mrow><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac><mo>+</mo><mfrac><mrow><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo><mfenced><mfrac><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo><mo>+</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac></mfenced><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mspace linebreak=\"newline\"/><mo>=</mo><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo><mfenced><mfrac><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">&#x3C0;</mi><mn>2</mn></mfrac><mo>-</mo><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>+</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo><mo>)</mo><mo>+</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac></mfenced><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo><mfenced><mfrac><mrow><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>+</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo><mo>+</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac></mfenced><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo><mfenced><mfrac><mrow><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mi>cos</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo></mrow><mrow><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac><mo>)</mo><mi>sin</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></mrow></mfrac></mfenced><mrow mathvariant=\"bold\" mathcolor=\"#007F00\"><mo>=</mo></mrow><mi>ctg</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">x</mi><mn>2</mn></mfrac><mo>)</mo><mi>ctg</mi><mfenced><mfrac><mi mathvariant=\"normal\">y</mi><mn>2</mn></mfrac></mfenced><mi>ctg</mi><mo>(</mo><mfrac><mi mathvariant=\"normal\">z</mi><mn>2</mn></mfrac><mo>)</mo></math>",
                result)
    }
}